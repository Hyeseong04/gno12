# 파이썬 트레이딩 저자의 코드 모음
https://github.com/pystockhub/book/blob/master/ch08/03.py
# 교재 (온라인)
https://wikidocs.net/3682


### 1부-파이썬프로그래밍 - 2부 증권사 API 기초

마이크로소프트 기술인 COM의 뜻? 여러 컴포넌트 객체를 파이썬에서 사용하도록 도와주는 것. 객체지향과 비슷.
win32com.client라는 모듈 내에 dispatch라는 함수로 사용가능 (익스플로어 , 워드, 엑셀 띄우기 가능)

[엑셀 열기] 
importwin32com.clientaswin32
excel=win32.gencache.EnsureDispatch('Excel.Application')

excel.Visible=True
wb=excel.Workbooks.Add()
ws=wb.Workbooks("Sheet1")

[대신증권 API 이용] 

import win32com.client

[연결 상태 확인 : 1, 0]
instCpCybos = win32com.client.Dispatch("CpUtil.CpCybos")
print(instCpCybos.IsConnect)

[종목코드 수]
instCpCybos = win32com.client.Dispatch("CpUtil.CpStockCode")
print(instCpCybos.GetCount())

[종목데이터(type, index)] 
import win32com.client

instCpCybos = win32com.client.Dispatch("CpUtil.CpStockCode")
for i in range(0, 10):
    print(instCpCybos.GetData(1, i))

>>> 동화약품
    KR모터스
    경방
    메리츠화재
    삼양홀딩스
    삼양홀딩스우
    하이트진로
    하이트진로2우B
    유한양행
    유한양행우

instCpStockCode = win32com.client.Dispatch("CpUtil.CpStockCode")
stockNum = instCpStockCode.GetCount()

for i in range(stockNum):
    if instCpStockCode.GetData(1, i) == 'NAVER':
        print(instCpStockCode.GetData(0, i))
        print(instCpStockCode.GetData(1, i))
        print(i)
        
>>> A035420
    NAVER
    868

instCpCodeMgr = win32com.client.Dispatch("CpUtil.CpCodeMgr")
codeList = instCpCodeMgr.GetStockListByMarket(1)

Kospi = {}
for code in codeList:
    name = instCpCodeMgr.CodeToName(code)
    Kospi[code] = name

f = open(r'C:\Users\nhss0\OneDrive\바탕 화면\Kospi.csv', 'w')
for key, value in Kospi.items():
    f.write("%s,%s\n" % (key, value))
f.close()

>>> CSV파일로 바탕화면에 저장

